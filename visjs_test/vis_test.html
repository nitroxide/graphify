<html>
<head>
    <script type="text/javascript" src="vis/dist/vis.js"></script>
	<script src="https://code.jquery.com/jquery-2.2.4.js" integrity="sha256-iT6Q9iMJYuQiMWNd9lDyBUStIq/8PuOW33aOqmvFpqI=" crossorigin="anonymous"></script>
    <link href="../../dist/vis.css" rel="stylesheet" type="text/css" />
	<link href="./bootstrap-3.3.6-dist/css/bootstrap.css" rel="stylesheet" type="text/css" />

    <style type="text/css">
        #mynetwork {
            border: 1px solid lightgray;
        }
		
		.nav > li > a {
			padding: 3px;
		}
    </style>
</head>
<body>
	<div class="wrapper">
		<div class="row">
	    	<div id="content" class="col-xs-8 col-md-10 content">
				<div id="mynetwork"></div>
	    	</div>
		    <div id="nav" class="col-xs-2 left">
	            <ul class="nav">
	              <li><a href="#">Default 1</a></li>
	              <li><a href="#">Zwei</a></li>             
	            </ul>
		   	</div>
		</div>
	</div>
<script type="text/javascript">
	
	var selectedTrack;
	
    $("#nav a").each(function() {
		$(this).click(function(e) {
			selectedTrack = this.innerHTML;
			//network.addNodeMode();
		});
    });
	
	// set size of vis
	var width = $("#content").width();
	var height = $(document).height();
	$("#mynetwork").css('width', width);
	$("#mynetwork").css('height', height);
	
	
	var imgDir = "img/";
    var nodes = new vis.DataSet([
        {id: 10, label: 'Node 1', shape: 'circularImage', group: "g1", image: imgDir + '1.jpeg'},
        {id: 20, label: 'Node 2', shape: 'circularImage', group: "g1", image: imgDir + '2.jpeg'},
        {id: 30, label: 'Node 3', shape: 'circularImage', group: "g1", image: imgDir + '3.jpeg'},
        {id: 40, label: 'Node 4', shape: 'circularImage', group: "g1", image: imgDir + '4.jpeg'},
        {id: 50, label: 'Node 5', shape: 'circularImage', group: "g1", image: imgDir + '5.jpeg'},
        {id: 60, label: 'Node 6', shape: 'circularImage', group: "g2", image: imgDir + '6.jpeg'},
        {id: 65, label: 'Node 6', shape: 'circularImage', group: "g2", image: imgDir + '6.jpeg'},
		{id: 70, label: 'Node 7', shape: 'circularImage', group: "g3", image: imgDir + '7.jpeg'},
        {id: 80, label: 'Node 8', shape: 'circularImage', group: "g3", image: imgDir + '8.jpeg'},
        {id: 90, label: 'Node 9', shape: 'circularImage', group: "g3", image: imgDir + '9.jpeg'},
    
        {id: 100, label: 'Cluster 1', shape: 'circular', group: "g1", image: imgDir + '9.jpeg'},
        {id: 110, label: 'Cluster 2', shape: 'circular', group: "g2", image: imgDir + '9.jpeg'},
        {id: 120, label: 'Cluster 3', shape: 'circular', group: "g3", image: imgDir + '9.jpeg'},
		
	
	]);

    // create an array with edges
    var edges = new vis.DataSet([
        {from: 10, to: 100},
        {from: 20, to: 100},
        {from: 30, to: 100},
        {from: 40, to: 100},
        {from: 50, to: 100},
		
        {from: 60, to: 110},
        {from: 65, to: 110},
		
        {from: 70, to: 120},
        {from: 80, to: 120},
        {from: 90, to: 120}
		
		
    ]);

    // create a network
    var container = document.getElementById('mynetwork');

    // provide the data in the vis format
    var data = {
        nodes: nodes,
        edges: edges
    };
	
    var options = {
		autoResize: true,
		height: '100%',
		width: '100%',
	    physics:{
	      enabled: true,
	    },
		
		nodes: {
			borderWidth:1,
			size:30,
			color: {
				border: '#222222',
				background: '#666666'
			},
				font:{color:'#eeeeee'}
			},
		edges: {
			color: 'gray'
		},
		groups: {
		    g1: {color:{border:'red'},		borderWidth:4},
		    g2: {color:{border:'green'},	borderWidth:4},
		    g3: {color:{border:'blue'},		borderWidth:4},
		    g4: {color:{border:'purple'},	borderWidth:4},
		    g5: {color:{border:'pink'},		borderWidth:4}
		  }
		
    };

    // initialize your network!
    var network = new vis.Network(container, data, options);
	
	
	function addNode(newId, newLabel, newX, newY) {
        data.nodes.add({
			id:newId,
			label: newLabel,
			shape: 'circle',
			x:newX,
			y:newY,
		});
	}
	
	
	network.on("click", function (params) {
		params.event = "[original event]";
		var x = params.pointer.canvas.x;
		var y = params.pointer.canvas.y;
        var newId = (Math.random() * 1e7).toString(32);
	
		addNode(newId, selectedTrack, x, y);
	});
	
	
	function onNodeDragged(params) {
		var allNodes = data.nodes.get({returnType: "Object"});
		var draggedNode = data.nodes.get({
		  filter: function (item) {
		    return item.id == params.nodes;
		  }
		})[0];
		
		
		for (n in allNodes) {
			node = allNodes[n];
			if (draggedNode.id != node.id) {
				if(intersects(draggedNode, node)) {
					console.log("Collision with ", node.id);
					onNodeIntersection(draggedNode, node);
				}
			}
		}
		
	}
	
	function onNodeIntersection(draggedNode, node) {
		// Change group of dragged node to other node's group
		data.nodes.update({id: draggedNode.id, group: node.group});
		//data.edges.add({from: draggedNode.id, to: node.id});
		
		
		console.log("Group Changed");
		
		/*
		// Push away overlap
		setAllNodesFixed(true);
		
		//setAllEdgesFixed(true);
		//setEdgeNonFixed(draggedNode, node);
		

		data.nodes.update({id: draggedNode.id, fixed: {x:false, y:false}});
		options.physics.enabled = true;
		network.setOptions(options);

		setTimeout(function(){
			options.physics.enabled = false;
			network.setOptions(options);
			setAllNodesFixed(false);
			//setAllEdgesNonFixed();
		}, 3000);
		
			*/
	}
	
	function setAllEdgesFixed(isFixed) {
		edges = data.edges;
		for (n in edges) {
			data.edges.update({id: edges[n].id, physics:!isFixed});		
		}
	}
	
	function setEdgeNonFixed(draggedNode, node) {
		edges = network.getConnectedEdges(draggedNode.id);

		data.edges.update({id: edges[0].id, physics:true});		
	}
	
	function setAllNodesFixed(isFixed) {
		var allNodes = data.nodes.get({returnType: "Object"});
		for (n in allNodes) {
			data.nodes.update({id: allNodes[n].id, fixed: {x:isFixed, y:isFixed}});
		}
	}
	
	function intersects(nodeA, nodeB) {
		var r1 = network.getBoundingBox(nodeA.id);
		var r2 = network.getBoundingBox(nodeB.id);		
		
		return !(r2.left > r1.right || 
		           r2.right < r1.left || 
		           r2.top > r1.bottom ||
		           r2.bottom < r1.top);
	}
</script>
</body>
</html>